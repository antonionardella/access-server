# STM32MP1

![drawing](/docs/images/stm32mp1.jpg)

The [STM32MP157C-DK2](https://www.st.com/en/evaluation-tools/stm32mp157c-dk2.html) Discovery Kit leverages the capabilities of STM32MP1 Series microprocessors to allow users easily develop [OpenSTLinux](https://www.st.com/en/embedded-software/stm32-mpu-openstlinux-distribution.html) applications for the ARM Dual Cortex A7 main processor, as well as STM32CubeMP1 software for the Cortex M4 coprocessor.

# OpenSTLinux

The IOTA Foundation and STMicroelectronics have an ongoing cooperation for the STM32Cube expansion software for the industry-leading STM32 32-bit MCU (Cortex-M*) ecosystem, the [X-CUBE-IOTA1](https://www.st.com/en/embedded-software/x-cube-iota1.html).

While the [X-CUBE-IOTA1](https://www.st.com/en/embedded-software/x-cube-iota1.html) toolkit is useful for the M4 coprocessor, weâ€™re going to focus on the **OpenSTLinux** of the Cortex A7.

![drawing](/docs/images/stm32mp1_tux.jpg)

# PiRelay

For this guide, you should also have a [PiRelay](https://shop.sb-components.co.uk/products/pirelay-relay-board-shield-for-raspberry-pi). Since the STM32MP157C-DK2 has a Raspberry Pi compatible pinout, we should be able to use the PiRelay on the kit without problems.

![drawing](/docs/images/stm32mp1_relay.jpg)

# Tutorial

This guide assumes you have followed the [**Getting Started**](https://wiki.st.com/stm32mpu/wiki/Getting_started/STM32MP1_boards/STM32MP157x-DK2) guide for STM32MP157x-DK2.

We assume you have:
- 1x STM32MP157x-DK2
- 1x PiRelay Raspberry Pi Shield
- 1x USB-C Cable
- 1x Power Supply
- 1x Ethernet Cable
- 1x LAN environment with DHCP
- 1x Ubuntu 18.04 host

# Running Access

1. Start by unscrewing the LCD screen so you can attach the PiRelay shield to the STM32MP157x-DK2.
2. Attach the PiRelay shield to the STM32MP157x-DK2
3. Connect the STM32MP157x-DK2 to the Router/Switch that gives entry to your LAN.
4. Scan the LAN for the board's IP. Here's the output of `nmap` on my setup:
```bash
$ sudo nmap -Pn 192.168.178.1/24
Nmap scan report for stm32mp1 (192.168.178.200)
Host is up (0.00065s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
MAC Address: 00:80:E1:42:6B:0C (STMicroelectronics SRL)
```
5. Connect to the OpenSTLinux environment via SSH. Here's what I did on my setup:
```bash
$ ssh root@192.168.178.200
The authenticity of host '192.168.178.200 (192.168.178.200)' can't be established.
RSA key fingerprint is SHA256:/p6Y1qR4p1VRDmEgwSb7ij1g1XegG6906I6N6DnkRNQ.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.178.200' (RSA) to the list of known hosts.
root@stm32mp1:~# 
```
6. Start the Access Server Reference Implementation:
```bash
$ asri
$ ./asri 
2020-08-29 16:04:16:  policy_loader:   INFO: [logger_init_policy_loader:42] enable logger policy_loader.
2020-08-29 16:04:16:   cclient_core:   INFO: [logger_init_client_core:16] enable logger cclient_core.
2020-08-29 16:04:16:cclient_extended:   INFO: [logger_init_client_extended:16] enable logger cclient_extended.
2020-08-29 16:04:16:         wallet:   INFO: [logger_init_wallet:42] enable logger wallet.
2020-08-29 16:04:16:         wallet:  DEBUG: [wallet_create:61] wallet initialized.
2020-08-29 16:04:16:         wallet:  DEBUG: [wallet_create:63] wallet depth: 3
2020-08-29 16:04:16:         wallet:  DEBUG: [wallet_create:65] wallet mwm: 10
2020-08-29 16:04:16:         wallet:  DEBUG: [wallet_create:67] wallet node url: nodes.comnet.thetangle.org:443
2020-08-29 16:04:16:         plugin:   INFO: [logger_init_plugin:42] enable logger plugin.
2020-08-29 16:04:16: policy_updater:   INFO: [logger_init_policy_updater:42] enable logger policy_updater.
2020-08-29 16:04:16: policy_updater:   INFO: [logger_init_policy_updater:42] enable logger policy_updater.
2020-08-29 16:04:16: access_network:   INFO: [logger_init_network:42] enable logger access_network.
2020-08-29 16:04:16:           auth:   INFO: [logger_init_auth:42] enable logger auth.
2020-08-29 16:04:16:         crypto:   INFO: [logger_init_crypto:42] enable logger crypto.
```
